#include <stdio.h>      // Для функций ввода-вывода (printf, scanf, FILE)
#include <stdlib.h>     // Для системных функций (system, malloc)
#include <ctype.h>      // Для функций работы с символами (tolower)
#include <string.h>     // Для функций работы со строками (strlen)
#include <locale.h>     // Для установки локали (русский язык)

// Функция для проверки, является ли символ гласной буквой
int is_vowel(char c) {
    c = tolower(c);  // Преобразуем символ в нижний регистр (чтобы 'A' и 'a' считались одинаково)
    return (c == 'a' || c == 'e' || c == 'i' || c == 'o' || c == 'u' || c == 'y');  // Проверяем, является ли символ одной из гласных
}

// Функция для проверки, является ли символ согласной буквой
int is_consonant(char c) {
    c = tolower(c);  // Преобразуем символ в нижний регистр
    // Проверяем: является ли символ английской буквой И НЕ является ли гласной
    return (c >= 'a' && c <= 'z' && !is_vowel(c));
}

// Функция для обработки строки - основная логика программы
void process_line(const char *input, char *output) {
    int vowels_count = 0;           // Счетчик гласных букв в строке
    int consonants_count = 0;       // Счетчик согласных букв в строке
    int vowels_present[26] = {0};   // Массив для отметки найденных гласных (0-25 = a-z)
    int consonants_present[26] = {0}; // Массив для отметки найденных согласных (0-25 = a-z)
    
    // Проходим по всем символам входной строки до конца строки (\0)
    for (int i = 0; input[i] != '\0'; i++) {
        char c = input[i];  // Текущий символ
        
        // Если символ - гласная буква
        if (is_vowel(c)) {
            vowels_count++;  // Увеличиваем счетчик гласных
            // Отмечаем эту гласную в массиве (tolower(c)-'a' дает индекс 0-25)
            vowels_present[tolower(c) - 'a'] = 1;
        } 
        // Если символ - согласная буква
        else if (is_consonant(c)) {
            consonants_count++;  // Увеличиваем счетчик согласных
            // Отмечаем эту согласную в массиве
            consonants_present[tolower(c) - 'a'] = 1;
        }
        // Если символ не английская буква (цифра, пробел, знак препинания) - игнорируем
    }
    
    int output_index = 0;  // Индекс для записи в выходную строку
    
    // Если гласных больше, чем согласных
    if (vowels_count > consonants_count) {
        // Проходим по всем возможным гласным (a-z)
        for (int i = 0; i < 26; i++) {
            // Если эта гласная была найдена в строке
            if (vowels_present[i]) {
                // Добавляем букву в выходную строку ('a'+0='a', 'a'+1='b', ...)
                output[output_index++] = 'a' + i;
            }
        }
    } 
    // Если согласных больше или равно гласным
    else {
        // Проходим по всем возможным согласным (a-z)
        for (int i = 0; i < 26; i++) {
            // Если эта согласная была найдена в строке
            if (consonants_present[i]) {
                // Добавляем букву в выходную строку
                output[output_index++] = 'a' + i;
            }
        }
    }
    
    output[output_index] = '\0';  // Завершаем строку нулевым символом
}

// Главная функция программы - точка входа
int main() {
    // Установка UTF-8 кодировки для правильного отображения русских букв
    system("chcp 65001 > nul");  // Меняем кодовую страницу консоли на UTF-8
    setlocale(LC_ALL, "ru_RU.UTF-8");  // Устанавливаем локаль для русского языка
    
    // Вывод информации о лабораторной работе
    printf("Лабораторная работа № 3\n");
    printf("Работа с файлами\n");
    printf("Группа: 6105-090301D\n");
    printf("Автор: Варламов Дамир Алексеевич\n\n");
    
    // Вывод условия задания
    printf("Задание 1.\n");
    printf("В исходном текстовом файле записаны строки, содержащие произвольные алфавитно-цифровые символы.\n");
    printf("Требуется для каждой строки выводить последовательность гласных или согласных строчных английских букв,\n");
    printf("каждую по одному разу, в зависимости от того, каких букв больше в строке.\n\n");
    
    // Объявление переменных
    FILE *input_file, *output_file;          // Указатели на файлы
    char input_filename[100], output_filename[100];  // Имена файлов
    char line[1000];          // Буфер для хранения одной строки из файла
    char result[1000];        // Буфер для хранения результата обработки строки
    
    // Запрос имен файлов у пользователя
    printf("Введите имя входного файла: ");
    scanf("%99s", input_filename);  // Читаем имя входного файла (макс 99 символов)
    printf("Введите имя выходного файла: ");
    scanf("%99s", output_filename); // Читаем имя выходного файла (макс 99 символов)
    
    // Открытие входного файла для чтения
    input_file = fopen(input_filename, "r");
    if (input_file == NULL) {  // Если файл не удалось открыть
        printf("Ошибка: не удалось открыть входной файл %s\n", input_filename);
        system("pause");  // Ждем нажатия клавиши
        return 1;         // Завершаем программу с ошибкой
    }
    
    // Открытие выходного файла для записи
    output_file = fopen(output_filename, "w");
    if (output_file == NULL) {  // Если файл не удалось создать
        printf("Ошибка: не удалось создать выходной файл %s\n", output_filename);
        fclose(input_file);  // Закрываем уже открытый входной файл
        system("pause");     // Ждем нажатия клавиши
        return 1;            // Завершаем программу с ошибкой
    }
    
    printf("\nОбработка файла...\n\n");
    
    int line_count = 0;  // Счетчик обработанных строк
    
    // Чтение файла построчно до конца файла
    while (fgets(line, sizeof(line), input_file) != NULL) {
        line_count++;  // Увеличиваем счетчик строк
        
        // Удаляем символ новой строки из конца строки
        size_t len = strlen(line);  // Получаем длину строки
        if (len > 0 && line[len - 1] == '\n') {
            line[len - 1] = '\0';  // Заменяем '\n' на конец строки '\0'
        }
        
        // Обрабатываем строку (основная логика программы)
        process_line(line, result);
        
        // Записываем результат в выходной файл
        fprintf(output_file, "%s\n", result);
        
        // Выводим информацию о обработке на экран
        printf("Строка %d:\n", line_count);
        printf("  Входная строка: '%s'\n", line);
        printf("  Результат: '%s'\n\n", result);
    }
    
    // Закрытие файлов
    fclose(input_file);
    fclose(output_file);
    
    // Сообщение о завершении работы
    printf("Обработка завершена. Результат записан в файл '%s'\n", output_filename);
    
    system("pause");  // Ожидание нажатия клавиши перед закрытием окна
    return 0;         // Успешное завершение программы
}

/*
РАЗБОР ЗАДАНИЯ ПРОСТЫМИ СЛОВАМИ:

Для каждой строки из файла:
1. Считаем сколько английских гласных (a,e,i,o,u,y) и согласных букв
2. Сравниваем: каких букв больше?
3. Если гласных больше -> выводим все уникальные гласные из строки
   Если согласных больше -> выводим все уникальные согласные из строки
4. Буквы выводим в алфавитном порядке и только по одному разу

ПРИМЕР:
Входная строка: "bbad, sdiv"
- Гласные: a, i (2 штуки)
- Согласные: b, b, d, s, d, v (6 штук)
- Согласных больше -> выводим согласные: b, d, s, v
- В алфавитном порядке: "bdsv"
*/